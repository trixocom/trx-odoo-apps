<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">
    <t t-name="llm_thread.LLMThreadHeader">
        <div
      t-if="hasActiveThread"
      class="o-llm-thread-header d-flex align-items-center p-3 border-bottom"
    >
            <!-- Thread Name Section -->
            <div class="flex-grow-1 d-flex align-items-center me-3">
                <t t-if="!state.isEditingName">
                    <h5
            class="mb-0 cursor-pointer"
            t-on-click="startEditingName"
            title="Click to edit"
          >
                        <t t-esc="activeThread.name" />
                        <i class="fa fa-pencil ms-2 text-muted small" />
                    </h5>
                </t>
                <t t-else="">
                    <div class="d-flex align-items-center">
                        <input
              type="text"
              class="form-control me-2"
              t-model="state.pendingName"
              t-on-keydown="onNameInputKeydown"
              t-ref="nameInput"
              placeholder="Thread name..."
              t-att-disabled="state.isLoadingUpdate"
            />
                        <button
              class="btn btn-sm btn-primary me-1"
              t-on-click="saveThreadName"
              t-att-disabled="state.isLoadingUpdate"
              title="Save"
            >
                            <i class="fa fa-check" />
                        </button>
                        <button
              class="btn btn-sm btn-secondary"
              t-on-click="cancelEditingName"
              t-att-disabled="state.isLoadingUpdate"
              title="Cancel"
            >
                            <i class="fa fa-times" />
                        </button>
                    </div>
                </t>
            </div>

            <!-- Related Record Component -->
            <div class="me-2 flex-shrink-0">
                <LLMRelatedRecord thread="activeThread" />
            </div>

            <!-- Dropdowns Section -->
            <div class="d-flex align-items-center gap-2">
                <!-- Loading Indicator -->
                <t t-if="state.isLoadingUpdate">
                    <i class="fa fa-spinner fa-spin text-muted" />
                </t>

                <!-- Provider Dropdown -->
                <Dropdown>
                    <button
            class="btn btn-sm btn-outline-secondary dropdown-toggle"
          >
                        <i class="fa fa-cloud me-1" />
                        <span
              t-if="currentProvider"
              t-esc="currentProvider.name"
            />
                        <span t-else="">Select Provider</span>
                    </button>
                    <t t-set-slot="content">
                        <t
              t-foreach="availableProviders"
              t-as="provider"
              t-key="provider.id"
            >
                            <DropdownItem
                onSelected="() => this.selectProvider(provider)"
                class="{'active': currentProvider?.id === provider.id}"
              >
                                <span t-esc="provider.name" />
                            </DropdownItem>
                        </t>
                        <div
              t-if="availableProviders.length === 0"
              class="dropdown-item-text text-muted"
            >
                            No providers available
                        </div>
                    </t>
                </Dropdown>

                <!-- Model Dropdown -->
                <Dropdown t-if="currentProvider">
                    <button
            class="btn btn-sm btn-outline-secondary dropdown-toggle"
          >
                        <i class="fa fa-cube me-1" />
                        <span t-if="currentModel" t-esc="currentModel.name" />
                        <span t-else="">Select Model</span>
                    </button>
                    <t t-set-slot="content">
                        <!-- Search Input -->
                        <div class="px-3 py-2">
                            <div class="input-group input-group-sm">
                                <input
                  type="text"
                  class="form-control"
                  placeholder="Search models..."
                  t-model="state.modelSearchQuery"
                  t-on-input="onModelSearchInput"
                />
                                <button
                  t-if="state.modelSearchQuery"
                  class="btn btn-outline-secondary"
                  t-on-click="clearModelSearch"
                >
                                    <i class="fa fa-times" />
                                </button>
                            </div>
                        </div>
                        <div class="dropdown-divider" />

                        <!-- Model List -->
                        <div style="max-height: 300px; overflow-y: auto;">
                            <t
                t-foreach="availableModels"
                t-as="model"
                t-key="model.id"
              >
                                <DropdownItem
                  onSelected="() => this.selectModel(model)"
                  class="{'active': currentModel?.id === model.id}"
                >
                                    <div
                    class="d-flex justify-content-between align-items-center"
                  >
                                        <span t-esc="model.name" />
                                        <t t-if="model.is_default">
                                            <span
                        class="badge bg-primary ms-2"
                      >Default</span>
                                        </t>
                                    </div>
                                </DropdownItem>
                            </t>
                            <div
                t-if="availableModels.length === 0"
                class="dropdown-item-text text-muted"
              >
                                <t t-if="state.modelSearchQuery">
                                    No models found matching "<t
                    t-esc="state.modelSearchQuery"
                  />"
                                </t>
                                <t t-else="">
                                    No models available for this provider
                                </t>
                            </div>
                        </div>
                    </t>
                </Dropdown>

                <!-- Tools Dropdown -->
                <Dropdown t-if="availableTools.length > 0">
                    <button
            class="btn btn-sm btn-outline-secondary dropdown-toggle"
          >
                        <i class="fa fa-wrench me-1" />
                        Tools
                        <t t-if="currentTools.length > 0">
                            (<t t-esc="currentTools.length" />)
                        </t>
                    </button>
                    <t t-set-slot="content">
                        <div
              style="max-height: 300px; overflow-y: auto; min-width: 250px;"
            >
                            <t
                t-foreach="availableTools"
                t-as="tool"
                t-key="tool.id"
              >
                                <div class="dropdown-item">
                                    <div class="form-check">
                                        <input
                      type="checkbox"
                      class="form-check-input"
                      t-att-id="'tool_' + tool.id"
                      t-att-checked="isToolSelected(tool)"
                      t-att-disabled="state.isLoadingUpdate"
                      t-on-change="() => this.toggleTool(tool)"
                    />
                                        <label
                      class="form-check-label w-100"
                      t-att-for="'tool_' + tool.id"
                      t-att-class="{'text-muted': state.isLoadingUpdate}"
                    >
                                            <span t-esc="tool.name" />
                                        </label>
                                    </div>
                                </div>
                            </t>
                            <div
                t-if="availableTools.length === 0"
                class="dropdown-item-text text-muted"
              >
                                No tools available
                            </div>
                        </div>
                    </t>
                </Dropdown>
            </div>
        </div>
    </t>
</templates>
